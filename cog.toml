# https://docs.cocogitto.io/

ignore_merge_commits = true
branch_whitelist = ["main"]
tag_prefix = "v"

# pre_bump_hooks = [
#   "cargo set-version {{version}}",
#   "cargo check --release",
#   "git add :/Cargo.lock",
# ]
pre_bump_hooks = [
  "cargo nextest run --profile ci",
  "cargo clippy --all-targets --all-features -- -D warnings",
  "cargo fmt --all",
  "cargo build --release",                                    # final check
]

post_bump_hooks = ["git push", "git push origin --tags"]

# pre_package_bump_hooks = [
#   "echo 'upgrading {{package}}' to {{version}}",
#   "cargo set-version {{version}}",
# ]

[git_hooks.commit-msg]
script = '''#!/bin/sh
set -e
perl -i -ne 'print unless /Generated with \[Claude Code\]\(https:\/\/claude\.com\/claude-code\)/ || /^Co-Authored-By: Claude/' "$1"
cog verify --file "$1"
'''

[git_hooks.pre-commit]
script = """#!/bin/sh
set -e
cargo fmt --all --check
cargo clippy -- -D warnings
"""

[git_hooks.pre-push]
script = """#!/bin/sh
set -e
cargo nextest run
"""

[changelog]
path = "CHANGELOG.md"
template = "remote"
remote = "github.com"
repository = "madskills"
owner = "madskilling"
authors = [{ signature = "Clay Loveless", username = "claylo" }]

[commit_types]
chore = { changelog_title = "", omit_from_changelog = true }
ci = { changelog_title = "", omit_from_changelog = true }

[packages]
madskills = { path = "crates/madskills", bump_order = 2 }
madskills-core = { path = "crates/madskills-core", bump_order = 1 }
